<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>CheckerFile.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">checker-core</a> &gt; <a href="index.source.html" class="el_package">com.luchersol.core.specialized_checkers.io</a> &gt; <span class="el_source">CheckerFile.java</span></div><h1>CheckerFile.java</h1><pre class="source lang-java linenums">package com.luchersol.core.specialized_checkers.io;

import static com.luchersol.core.util.Message.*;

import java.io.File;
import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.Arrays;
import java.util.stream.Stream;

import com.luchersol.core.util.AbstractChecker;

/**
 * {@code CheckerFile} provides a fluent API for performing various checks and validations on {@link java.io.File} objects.
 * &lt;p&gt;
 * This class extends {@code AbstractChecker} and allows users to verify file properties such as existence, type, permissions,
 * size, extension, and content identity. It supports both files and directories, and can be used to validate files by path or by {@code File} instance.
 * &lt;/p&gt;
 *
 * &lt;p&gt;Example usage:&lt;/p&gt;
 * &lt;pre&gt;
 * CheckerFile checker = CheckerFile.check(&quot;example.txt&quot;)
 *         .exists()
 *         .canRead()
 *         .withExtension(&quot;txt&quot;);
 * &lt;/pre&gt;
 *
 * &lt;p&gt;
 * The class supports method chaining for fluent validation.
 * &lt;/p&gt;
 */
public class CheckerFile extends AbstractChecker&lt;File, CheckerFile&gt; {

    private static final String INIT_FILE = &quot;io.file&quot;;
    private static final String DEFAULT_NAME = &quot;File&quot;;


    /**
     * Constructs a new {@code CheckerFile} with the specified file and name.
     *
     * @param file the {@link File} object representing the file to be associated with this {@code CheckerFile}
     * @param name the name to be assigned to this {@code CheckerFile}
     */
    protected CheckerFile(File file, String name) {
<span class="fc" id="L48">        super(file, name);</span>
<span class="fc" id="L49">    }</span>


    /**
     * Creates a CheckerFile for the given file and assigns a custom name.
     *
     * @param file the file to check
     * @param name the name to assign to this checker
     * @return a CheckerFile instance for the given file
     */
    public static CheckerFile check(File file, String name) {
<span class="fc" id="L60">        return new CheckerFile(file, name);</span>
    }

    /**
     * Creates a CheckerFile from a string pathname and assigns a custom name.
     *
     * @param pathname the path to the file
     * @param name the name to assign to this checker
     * @return a CheckerFile instance for the given path
     */
    public static CheckerFile check(String pathname, String name) {
<span class="nc" id="L71">        File file = new File(pathname);</span>
<span class="nc" id="L72">        return check(file, name);</span>
    }

    /**
     * Creates a CheckerFile for the given file with a default name.
     *
     * @param file the file to check
     * @return a CheckerFile instance for the given file
     */
    public static CheckerFile check(File file) {
<span class="nc" id="L82">        return check(file, DEFAULT_NAME);</span>
    }

    /**
     * Creates a CheckerFile from a string pathname with a default name.
     *
     * @param pathname the path to the file
     * @return a CheckerFile instance for the given path
     */
    public static CheckerFile check(String pathname) {
<span class="nc" id="L92">        File file = new File(pathname);</span>
<span class="nc" id="L93">        return check(file);</span>
    }

    /**
     * Returns this instance (for fluent API).
     *
     * @return this CheckerFile instance
     */
    @Override
    protected CheckerFile self() {
<span class="fc" id="L103">        return this;</span>
    }

    /**
     * Checks if the file exists.
     *
     * @return this CheckerFile instance
     */
    public CheckerFile exists(){
<span class="fc" id="L112">        return is(file -&gt; file.exists(), sendMessage(INIT_FILE, &quot;exists&quot;));</span>
    }

    /**
     * Checks if the file is a regular file (not a directory).
     *
     * @return this CheckerFile instance
     */
    public CheckerFile isTypeFile(){
<span class="fc" id="L121">        return is(file -&gt; file.isFile(), sendMessage(INIT_FILE, &quot;is_type_file&quot;));</span>
    }

    /**
     * Checks if the file is a directory.
     *
     * @return this CheckerFile instance
     */
    public CheckerFile isTypeDirectory(){
<span class="fc" id="L130">        return is(file -&gt; file.isDirectory(), sendMessage(INIT_FILE, &quot;is_type_directory&quot;));</span>
    }

    /**
     * Checks if the file is hidden.
     *
     * @return this CheckerFile instance
     */
    public CheckerFile isTypeHidden(){
<span class="fc" id="L139">        return is(file -&gt; file.isHidden(), sendMessage(INIT_FILE, &quot;is_type_hidden&quot;));</span>
    }

    /**
     * Checks if the file can be read.
     *
     * @return this CheckerFile instance
     */
    public CheckerFile canRead(){
<span class="fc" id="L148">        return is(file -&gt; file.canRead(), sendMessage(INIT_FILE, &quot;can_read&quot;));</span>
    }

    /**
     * Checks if the file can be written to.
     *
     * @return this CheckerFile instance
     */
    public CheckerFile canWrite(){
<span class="fc" id="L157">        return is(file -&gt; file.canWrite(), sendMessage(INIT_FILE, &quot;can_write&quot;));</span>
    }

    /**
     * Checks if the file size is at least the specified minimum number of bytes.
     *
     * @param minBytes the minimum file size in bytes
     * @return this CheckerFile instance
     */
    public CheckerFile min(int minBytes){
<span class="fc bfc" id="L167" title="All 2 branches covered.">        return is(file -&gt; minBytes &lt;= getFileSize(file), sendMessage(INIT_FILE, &quot;min&quot;, minBytes));</span>
    }

    /**
     * Checks if the file size is at most the specified maximum number of bytes.
     *
     * @param maxBytes the maximum file size in bytes
     * @return this CheckerFile instance
     */
    public CheckerFile max(int maxBytes){
<span class="fc" id="L177">        isTypeFile();</span>
<span class="fc bfc" id="L178" title="All 2 branches covered.">        return is(file -&gt; getFileSize(file) &lt;= maxBytes, sendMessage(INIT_FILE, &quot;max&quot;, maxBytes));</span>
    }

    /**
     * Checks if the file size is within the specified range (inclusive).
     *
     * @param minBytes the minimum file size in bytes
     * @param maxBytes the maximum file size in bytes
     * @return this CheckerFile instance
     */
    public CheckerFile inRange(int minBytes, int maxBytes){
<span class="fc" id="L189">        isTypeFile();</span>
<span class="pc bpc" id="L190" title="2 of 4 branches missed.">        return is(file -&gt; minBytes &lt;= getFileSize(file) &amp;&amp; getFileSize(file) &lt;= maxBytes, sendMessage(INIT_FILE, &quot;in_range&quot;, minBytes, maxBytes));</span>
    }

    /**
     * Checks if the file has the specified extension.
     *
     * @param extension the file extension to check for (without dot)
     * @return this CheckerFile instance
     */
    public CheckerFile withExtension(String extension) {
<span class="fc" id="L200">        return is(file -&gt; getFileExtension(file).equals(extension), sendMessage(INIT_FILE, &quot;with_extension&quot;));</span>
    }

    /**
     * Checks if the file has any of the specified extensions.
     *
     * @param extensions the file extensions to check for (without dot)
     * @return this CheckerFile instance
     */
    public CheckerFile withAnyExtension(String... extensions) {
<span class="fc" id="L210">        return is(file -&gt; Stream.of(extensions).anyMatch(extension -&gt; getFileExtension(file).equals(extension)), sendMessage(INIT_FILE, &quot;with_any_extension&quot;));</span>
    }

    /**
     * Checks if the file is identical to another file at the specified path.
     *
     * @param path the path to the file to compare with
     * @return this CheckerFile instance
     */
    public CheckerFile isIdentical(String path) {
<span class="fc" id="L220">        return is(file -&gt; areFilesIdentical(file, path), sendMessage(INIT_FILE, &quot;with_any_extension&quot;));</span>
    }

    /**
     * Compares two files for identical content and size.
     *
     * @param file1 the first file
     * @param path2 the path to the second file
     * @return true if the files are identical, false otherwise
     */
    private static boolean areFilesIdentical(File file1, String path2) {
<span class="fc" id="L231">        Path file2 = Paths.get(path2);</span>
        try {
<span class="fc bfc" id="L233" title="All 2 branches covered.">            if (file1.length() != Files.size(file2)) return false;</span>

<span class="fc" id="L235">            try (InputStream in1 = Files.newInputStream(file1.toPath());</span>
<span class="fc" id="L236">                InputStream in2 = Files.newInputStream(file2)) {</span>

<span class="fc" id="L238">                byte[] buf1 = new byte[8192];</span>
<span class="fc" id="L239">                byte[] buf2 = new byte[8192];</span>

                int n1, n2;
<span class="fc bfc" id="L242" title="All 2 branches covered.">                while ((n1 = in1.read(buf1)) != -1) {</span>
<span class="fc" id="L243">                    n2 = in2.read(buf2);</span>
<span class="pc bpc" id="L244" title="2 of 4 branches missed.">                    if (n1 != n2 || !Arrays.equals(buf1, buf2)) {</span>
<span class="nc" id="L245">                        return false;</span>
                    }
                }
<span class="fc" id="L248">                return true;</span>
<span class="nc bnc" id="L249" title="All 4 branches missed.">            }</span>
<span class="nc" id="L250">        } catch (IOException e) {</span>
<span class="nc" id="L251">            return false;</span>
        }
    }

    /**
     * Gets the extension of the given file.
     *
     * @param file the file whose extension is to be retrieved
     * @return the file extension as a String, or an empty string if none
     */
    private static String getFileExtension(File file){
<span class="fc" id="L262">        String fileName = file.getName();</span>
<span class="fc" id="L263">        int lastIndexOfDot = fileName.lastIndexOf('.');</span>

<span class="pc bpc" id="L265" title="2 of 4 branches missed.">        if (lastIndexOfDot == -1 || lastIndexOfDot == 0) return &quot;&quot;;</span>

<span class="fc" id="L267">        return fileName.substring(lastIndexOfDot + 1);</span>
    }

    /**
     * Gets the size of the given file or directory (recursively).
     *
     * @param file the file or directory
     * @return the size in bytes
     */
    private static long getFileSize(File file) {
<span class="pc bpc" id="L277" title="2 of 4 branches missed.">        if (file == null || !file.exists()) return 0;</span>

<span class="pc bpc" id="L279" title="1 of 2 branches missed.">        if (file.isFile()) return file.length();</span>

<span class="nc" id="L281">        long size = 0;</span>
<span class="nc" id="L282">        File[] files = file.listFiles();</span>

<span class="nc bnc" id="L284" title="All 2 branches missed.">        if (files != null) {</span>
<span class="nc bnc" id="L285" title="All 2 branches missed.">            for (File f : files) {</span>
<span class="nc" id="L286">                size += getFileSize(f);</span>
            }
        }

<span class="nc" id="L290">        return size;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>